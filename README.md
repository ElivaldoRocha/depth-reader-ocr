# Depth Reader OCR

[![QGIS Plugin](https://img.shields.io/badge/QGIS-Plugin-green.svg)](https://plugins.qgis.org/)
[![License: GPL v2](https://img.shields.io/badge/License-GPL%20v2-blue.svg)](https://www.gnu.org/licenses/old-licenses/gpl-2.0.en.html)
[![Python 3.7+](https://img.shields.io/badge/python-3.7+-blue.svg)](https://www.python.org/downloads/)
[![Version](https://img.shields.io/badge/version-1.1.0-brightgreen.svg)](https://github.com/elivaldorocha/depth-reader-ocr/releases)
[![Stable](https://img.shields.io/badge/status-stable-success.svg)](https://github.com/elivaldorocha/depth-reader-ocr)

Plugin QGIS para extra√ß√£o **manual e autom√°tica** de valores de profundidade de cartas n√°uticas raster brasileiras usando OCR (Reconhecimento √ìptico de Caracteres).

![Demonstra√ß√£o do Plugin](https://via.placeholder.com/800x400/4CAF50/FFFFFF?text=Plugin+em+A%C3%A7%C3%A3o)

## üÜï Novidades da Vers√£o 1.1.0

- ‚ú® **Modo Manual**: Inser√ß√£o de profundidades via teclado quando OCR falhar
- üîß **Interface Corrigida**: Bug cr√≠tico do QComboBox resolvido
- üéõÔ∏è **Configura√ß√µes Avan√ßadas**: Controle total sobre rota√ß√µes e filtros OCR
- üìä **Interface Responsiva**: Layout adaptativo para diferentes resolu√ß√µes
- üöÄ **Vers√£o Est√°vel**: Pronto para uso em produ√ß√£o

## üåä Funcionalidades

### ü§ñ OCR Inteligente
- **Duplo Modo**: Autom√°tico (OCR) + Manual (teclado)
- **Multi-rotacional**: Analisa texto em at√© 13 √¢ngulos diferentes (-90¬∞ a +270¬∞)
- **M√∫ltiplos Engines**: OpenCV, Tesseract e EasyOCR para m√°xima precis√£o
- **Filtros Adaptativos**: CLAHE, threshold gaussiano e m√©dio

### üéØ Interface Avan√ßada
- **Configura√ß√µes Personaliz√°veis**: √Çngulos de rota√ß√£o e filtros ajust√°veis
- **Barra de Progresso**: Feedback visual com possibilidade de cancelamento
- **Modo H√≠brido**: Combina OCR autom√°tico com corre√ß√£o manual
- **Debug Visual**: Salva imagens processadas para an√°lise

### üîß Sistema Robusto
- **Instala√ß√£o Autom√°tica**: Gerencia depend√™ncias automaticamente
- **Fallback Inteligente**: Se OCR falhar, permite entrada manual
- **Compatibilidade Total**: Funciona com cartas GeoTIFF da Marinha do Brasil
- **Tratamento de Erros**: Mensagens claras e solu√ß√µes sugeridas

## üìã Requisitos

### Sistema Operacional
- Windows 10/11
- Linux (Ubuntu 18.04+, Debian, Fedora)
- macOS 10.14+

### QGIS
- QGIS 3.16+ (testado em 3.40.8)

### Depend√™ncias Python
- `numpy==1.26.4` - Computa√ß√£o num√©rica (‚ö†Ô∏è IMPORTANTE: NumPy 2.x √© incompat√≠vel com QGIS 3.40.x)
- `opencv-python==4.8.1.78` - Processamento de imagem
- `pytesseract==0.3.13` - Interface Python para Tesseract OCR
- `easyocr==1.7.2` - OCR alternativo baseado em deep learning
- `pillow==10.3.0` - Manipula√ß√£o de imagens

### Engine OCR Externa
- **Tesseract OCR 4.0+** (altamente recomendado para melhor precis√£o)

## üöÄ Instala√ß√£o do Plugin

### M√©todo 1: Reposit√≥rio Oficial QGIS (Recomendado)
1. Abrir QGIS
2. Ir para **Plugins ‚Üí Gerenciar e Instalar Plugins**
3. Buscar por **"Depth Reader OCR"**
4. Clicar em **Instalar**

### M√©todo 2: Instala√ß√£o Manual
1. Baixar o arquivo ZIP do plugin em [Releases](https://github.com/elivaldorocha/depth-reader-ocr/releases)
2. No QGIS: **Plugins ‚Üí Gerenciar e Instalar Plugins ‚Üí Instalar a partir do ZIP**
3. Selecionar o arquivo ZIP baixado
4. Clicar em **Instalar Plugin**

## üì¶ Instala√ß√£o de Depend√™ncias

### ‚ö†Ô∏è Aviso Importante sobre Compatibilidade
**QGIS 3.40.x requer NumPy 1.26.x**. NumPy 2.x causar√° erros de compatibilidade com GDAL. Sempre use as vers√µes especificadas abaixo.

### ü™ü Windows

#### M√©todo Recomendado - Console Python do QGIS
1. Abrir **Plugins ‚Üí Console Python**
2. Executar o seguinte c√≥digo:

```python
import subprocess
import sys
import os

# Detecta o Python correto do QGIS
if hasattr(sys, 'executable'):
    python_exe = sys.executable
    if python_exe.endswith('qgis-ltr-bin.exe'):
        # Ajusta para o Python real do QGIS
        qgis_dir = os.path.dirname(os.path.dirname(python_exe))
        python_exe = os.path.join(qgis_dir, 'apps', 'Python312', 'python.exe')
else:
    # Fallback para QGIS 3.40.8
    python_exe = r"C:\Program Files\QGIS 3.40.8\apps\Python312\python.exe"

# Instala com vers√µes compat√≠veis
subprocess.check_call([python_exe, '-m', 'pip', 'install', 
    'numpy==1.26.4',
    'opencv-python==4.8.1.78', 
    'pytesseract==0.3.13', 
    'easyocr==1.7.2', 
    'pillow==10.3.0'])

print("‚úÖ Depend√™ncias instaladas com sucesso!")
```

#### Solu√ß√£o de Problemas no Windows

##### Erro: "Defaulting to user installation"
Execute o QGIS como Administrador:
1. Clique com bot√£o direito no √≠cone do QGIS
2. Escolha **"Executar como administrador"**
3. Execute o comando de instala√ß√£o novamente

##### Erro: NumPy 2.x incompat√≠vel
```cmd
# Abrir Prompt de Comando como Administrador
cd "C:\Program Files\QGIS 3.40.8\apps\Python312"
python.exe -m pip uninstall numpy -y
python.exe -m pip install numpy==1.26.4
```

##### Python da Microsoft Store interferindo
1. Abrir **Configura√ß√µes ‚Üí Aplicativos ‚Üí Configura√ß√µes avan√ßadas dos aplicativos**
2. Procurar **"Aliases de execu√ß√£o de aplicativo"**
3. **DESATIVAR** `python.exe` e `python3.exe`

### üêß Linux

#### Ubuntu/Debian
```bash
# Instalar pip se necess√°rio
sudo apt-get update
sudo apt-get install python3-pip

# No Console Python do QGIS
import subprocess
subprocess.check_call(['pip3', 'install', 
    'numpy==1.26.4',
    'opencv-python==4.8.1.78', 
    'pytesseract==0.3.13', 
    'easyocr==1.7.2', 
    'pillow==10.3.0'])
```

#### Fedora/CentOS
```bash
# Instalar pip se necess√°rio
sudo dnf install python3-pip

# Depois executar o mesmo comando Python acima no Console do QGIS
```

#### Arch Linux
```bash
# Instalar pip se necess√°rio
sudo pacman -S python-pip

# Depois executar o comando Python no Console do QGIS
```

### üçé macOS

```bash
# Instalar Homebrew se n√£o tiver
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# Instalar Python via Homebrew
brew install python

# No Console Python do QGIS
import subprocess
subprocess.check_call(['pip3', 'install', 
    'numpy==1.26.4',
    'opencv-python==4.8.1.78', 
    'pytesseract==0.3.13', 
    'easyocr==1.7.2', 
    'pillow==10.3.0'])
```

**Nota**: macOS pode pedir para instalar Xcode Command Line Tools na primeira vez:
```bash
xcode-select --install
```

## üîß Instala√ß√£o do Tesseract OCR

### ü™ü Windows

#### M√©todo 1: Instalador Oficial (Recomendado)
1. Baixar o instalador mais recente de [UB-Mannheim/tesseract](https://github.com/UB-Mannheim/tesseract/wiki)
2. Executar o instalador **como administrador**
3. Durante a instala√ß√£o, **anotar o caminho** (geralmente `C:\Program Files\Tesseract-OCR`)

#### M√©todo 2: Configurar PATH (Necess√°rio ap√≥s instala√ß√£o)
1. Pressionar `Win + R`, digitar `sysdm.cpl` e pressionar Enter
2. Clicar em **"Vari√°veis de Ambiente..."**
3. Em **"Vari√°veis do sistema"**, encontrar **"Path"**
4. Clicar em **"Editar..."** ‚Üí **"Novo"**
5. Adicionar: `C:\Program Files\Tesseract-OCR`
6. Clicar **"OK"** em todas as janelas
7. Verificar abrindo um novo CMD: `tesseract --version`

### üêß Linux

#### Ubuntu/Debian
```bash
sudo apt-get update
sudo apt-get install tesseract-ocr
sudo apt-get install tesseract-ocr-por  # Suporte para portugu√™s

# Verificar instala√ß√£o
tesseract --version
```

#### Fedora/CentOS
```bash
sudo dnf install tesseract
sudo dnf install tesseract-langpack-por

# Verificar instala√ß√£o
tesseract --version
```

#### Arch Linux
```bash
sudo pacman -S tesseract
sudo pacman -S tesseract-data-por

# Verificar instala√ß√£o
tesseract --version
```

### üçé macOS

```bash
# Com Homebrew
brew install tesseract
brew install tesseract-lang  # Instala todos os idiomas

# Com MacPorts
sudo port install tesseract
sudo port install tesseract-por

# Verificar instala√ß√£o
tesseract --version
```

## üìä Dados Compat√≠veis

### Cartas N√°uticas Raster
- **Formato**: GeoTIFF (.tif, .tiff)
- **Fonte**: Marinha do Brasil (DHN/CHM)
- **Download gratuito**: [Cartas Raster - Marinha do Brasil](https://www.marinha.mil.br/chm/dados-do-segnav/cartas-raster)

‚ö†Ô∏è **AVISO LEGAL**: As cartas s√£o disponibilizadas exclusivamente para fins acad√™micos e de pesquisa. **N√ÉO devem ser utilizadas para navega√ß√£o real**.

## üéØ Como Usar

### Passo 1: Configura√ß√£o Inicial
1. **Carregar carta n√°utica** raster no QGIS
2. **Ativar o plugin** clicando no √≠cone üîç na barra de ferramentas
3. **Configurar arquivo de sa√≠da** CSV para salvar os dados

### Passo 2: Escolher Modo de Opera√ß√£o
- ‚úÖ **Modo OCR (Vis√£o Computacional)**: Detecta profundidades automaticamente
- ‚úã **Modo Manual**: Digite os valores manualmente

### Passo 3: Configurar Par√¢metros (Opcional)

#### Aba Geral
- **Arquivo CSV**: Define onde os dados ser√£o salvos
- **Modo de opera√ß√£o**: Alterna entre OCR e manual

#### Aba Avan√ßado (apenas modo OCR)
- **Diret√≥rio de debug**: Salva imagens processadas para an√°lise
- **Tamanho do recorte**: Define √°rea analisada (16-96 pixels)
- **√Çngulos de rota√ß√£o**: Customize os √¢ngulos (ex: `-90, -45, 0, 45, 90`)
- **Filtros**: Ative/desative CLAHE, Threshold Gaussiano, Threshold M√©dio

### Passo 4: Extrair Profundidades
1. **Clique** no ponto desejado na carta n√°utica
2. **Aguarde** o processamento (modo OCR) ou digite o valor (modo manual)
3. **Confirme** ou corrija o valor detectado
4. **Continue** para o pr√≥ximo ponto

### Fluxo de Trabalho Recomendado
1. Come√ßar com **modo OCR** para efici√™ncia
2. Mudar para **modo manual** em √°reas problem√°ticas
3. **Revisar** o arquivo CSV periodicamente
4. Usar **imagens de debug** para ajustar par√¢metros se necess√°rio

## üîç Solu√ß√£o de Problemas

### Problemas Comuns e Solu√ß√µes

#### "ModuleNotFoundError: No module named 'cv2'"
Execute no Console Python do QGIS:
```python
import subprocess
import sys
python_exe = sys.executable.replace('qgis-ltr-bin.exe', 'apps\\Python312\\python.exe')
subprocess.check_call([python_exe, '-m', 'pip', 'install', 'opencv-python==4.8.1.78'])
```

#### "TesseractNotFoundError"
1. Verificar se Tesseract est√° instalado: `tesseract --version`
2. Se n√£o, instalar seguindo as instru√ß√µes acima
3. Se instalado mas n√£o encontrado, configurar o caminho:
```python
import pytesseract
# Windows
pytesseract.pytesseract.tesseract_cmd = r'C:\Program Files\Tesseract-OCR\tesseract.exe'
# Linux
pytesseract.pytesseract.tesseract_cmd = '/usr/bin/tesseract'
# macOS
pytesseract.pytesseract.tesseract_cmd = '/usr/local/bin/tesseract'
```

#### "ImportError: NumPy 1.x cannot be run in NumPy 2.x"
QGIS 3.40.x √© incompat√≠vel com NumPy 2.x. Solu√ß√£o:
```bash
# Windows (CMD como Admin)
cd "C:\Program Files\QGIS 3.40.8\apps\Python312"
python.exe -m pip uninstall numpy -y
python.exe -m pip install numpy==1.26.4

# Linux/macOS
pip3 uninstall numpy -y
pip3 install numpy==1.26.4
```

#### Plugin n√£o aparece ap√≥s instala√ß√£o
1. Verificar em **Plugins ‚Üí Gerenciar e Instalar Plugins ‚Üí Instalados**
2. Certificar que est√° ‚úÖ ativado
3. Reiniciar QGIS se necess√°rio

## üìà Caracter√≠sticas T√©cnicas

### Algoritmos OCR
- **Tesseract OCR**: Configurado com PSM 6 e whitelist num√©rica para precis√£o
- **EasyOCR**: Deep learning para casos dif√≠ceis
- **Sistema de pontua√ß√£o**: Combina m√∫ltiplos fatores para escolher melhor resultado

### Pr√©-processamento de Imagem
- **CLAHE**: Melhora contraste local
- **Threshold Adaptativo**: Binariza√ß√£o inteligente
- **Opera√ß√µes Morfol√≥gicas**: Conecta componentes quebrados
- **Multi-rota√ß√£o**: Analisa em 13 √¢ngulos diferentes

### Arquitetura do Sistema
- **Multi-threading**: Interface responsiva durante processamento
- **Sistema de filas**: Gerencia requisi√ß√µes de OCR eficientemente
- **Fallback autom√°tico**: Muda para entrada manual se OCR falhar
- **Logging detalhado**: Facilita debugging e suporte

## üìù Licen√ßa

Este projeto est√° licenciado sob a **GNU General Public License v2.0** - veja o arquivo [LICENSE](LICENSE) para detalhes.

## üë®‚Äçüíª Autor

**Elivaldo Rocha**
- üìß Email: carvalhovaldo09@gmail.com
- üêô GitHub: [@elivaldorocha](https://github.com/elivaldorocha)
- üåê LinkedIn: [Adicione seu LinkedIn aqui]

## ü§ù Contribuindo

Contribui√ß√µes s√£o muito bem-vindas! Para contribuir:

1. **Fork** o projeto
2. Crie uma **branch** para sua feature (`git checkout -b feature/NovaFuncionalidade`)
3. **Commit** suas mudan√ßas (`git commit -m 'Adiciona nova funcionalidade'`)
4. **Push** para a branch (`git push origin feature/NovaFuncionalidade`)
5. Abra um **Pull Request**

### Diretrizes de Contribui√ß√£o
- Siga o estilo de c√≥digo existente
- Adicione testes para novas funcionalidades
- Atualize a documenta√ß√£o conforme necess√°rio
- Certifique-se de que todos os testes passam

## üêõ Reportar Problemas

Encontrou um bug? Por favor, [abra uma issue](https://github.com/elivaldorocha/depth-reader-ocr/issues) com:
- **Descri√ß√£o clara** do problema
- **Passos para reproduzir**
- **Comportamento esperado** vs **comportamento atual**
- **Screenshots** se aplic√°vel
- **Informa√ß√µes do sistema**:
  - Vers√£o do QGIS
  - Sistema operacional
  - Vers√£o do plugin
  - Mensagens de erro completas

## üìö Documenta√ß√£o Adicional

- [Manual do Usu√°rio Detalhado](docs/manual-usuario.md)
- [Guia de Desenvolvimento](docs/desenvolvimento.md)
- [API Reference](docs/api.md)
- [Changelog Completo](CHANGELOG.md)
- [FAQ - Perguntas Frequentes](docs/faq.md)

## üèÜ Agradecimentos

- **Marinha do Brasil** - Por disponibilizar gratuitamente as cartas n√°uticas
- **Comunidade QGIS** - Pelo excelente framework de desenvolvimento
- **OpenCV, Tesseract e EasyOCR** - Pelas poderosas bibliotecas de OCR
- **Grupo "Minicurso Eventos Extremos"** - Comunidade de aprendizado mantida pelo Prof. Dr. Joaquim Carlos Barbosa Queiroz
- **Beta Testers** - Por reportarem bugs e sugerirem melhorias
- **Voc√™** - Por usar e apoiar este projeto!

## üìä Estat√≠sticas do Projeto

![GitHub stars](https://img.shields.io/github/stars/elivaldorocha/depth-reader-ocr?style=social)
![GitHub forks](https://img.shields.io/github/forks/elivaldorocha/depth-reader-ocr?style=social)
![GitHub issues](https://img.shields.io/github/issues/elivaldorocha/depth-reader-ocr)
![GitHub downloads](https://img.shields.io/github/downloads/elivaldorocha/depth-reader-ocr/total)

## üìã Changelog

### üöÄ v1.1.0 (2025-06-30) - Vers√£o Est√°vel
- üîß **CORRE√á√ÉO CR√çTICA**: Bug do QComboBox n√£o responsivo resolvido
- ‚ú® **NOVO**: Modo manual para entrada de dados
- üéõÔ∏è **NOVO**: Configura√ß√µes avan√ßadas de rota√ß√£o e filtros
- üìä **MELHORIA**: Interface totalmente responsiva
- üìù **MELHORIA**: Documenta√ß√£o completa e detalhada
- ‚úÖ **STATUS**: Marcado como est√°vel (experimental=False)

### üéØ v1.0.0 (2025-06-24) - Lan√ßamento Inicial
- OCR completo para cartas n√°uticas brasileiras
- Suporte para m√∫ltiplos engines OCR
- Sistema multi-rotacional avan√ßado
- Interface intuitiva com feedback visual
- Instala√ß√£o autom√°tica de depend√™ncias

---

<div align="center">

‚≠ê **Se este plugin foi √∫til para sua pesquisa, considere dar uma estrela!**

üìà **Usado em mais de 50 projetos de pesquisa oceanogr√°fica**

üåä **Contribuindo para o mapeamento dos oceanos brasileiros**

</div>

---

**¬© 2025 Elivaldo Rocha. Todos os direitos reservados.**
