# Depth Reader OCR

[![QGIS Plugin](https://img.shields.io/badge/QGIS-Plugin-green.svg)](https://plugins.qgis.org/)
[![License: GPL v2](https://img.shields.io/badge/License-GPL%20v2-blue.svg)](https://www.gnu.org/licenses/old-licenses/gpl-2.0.en.html)
[![Python 3.7+](https://img.shields.io/badge/python-3.7+-blue.svg)](https://www.python.org/downloads/)
[![Version](https://img.shields.io/badge/version-1.1.0-brightgreen.svg)](https://github.com/elivaldorocha/depth-reader-ocr/releases)
[![Stable](https://img.shields.io/badge/status-stable-success.svg)](https://github.com/elivaldorocha/depth-reader-ocr)

Plugin QGIS para extra√ß√£o **manual e autom√°tica** de valores de profundidade de cartas n√°uticas raster brasileiras usando OCR (Reconhecimento √ìptico de Caracteres).

[Demonstra√ß√£o do Plugin - ‚ö†Ô∏è üìπ ainda preparando o v√≠deo! üìπ]()

## üÜï Novidades da Vers√£o 1.1.0

- ‚ú® **Modo Manual**: Inser√ß√£o de profundidades via teclado quando OCR falhar
- üîß **Interface Corrigida**: Bug cr√≠tico do QComboBox resolvido
- üéõÔ∏è **Configura√ß√µes Avan√ßadas**: Controle total sobre rota√ß√µes e filtros OCR
- üìä **Interface Responsiva**: Layout adaptativo para diferentes resolu√ß√µes
- üöÄ **Vers√£o Est√°vel**: Pronto para uso em produ√ß√£o

## üåä Funcionalidades

### ü§ñ OCR Inteligente
- **Duplo Modo**: Autom√°tico (OCR) + Manual (teclado)
- **Multi-rotacional**: Analisa texto em at√© 13 √¢ngulos diferentes (-90¬∞ a +270¬∞)
- **M√∫ltiplos Engines**: OpenCV, Tesseract e EasyOCR para m√°xima precis√£o
- **Filtros Adaptativos**: CLAHE, threshold gaussiano e m√©dio

### üéØ Interface Avan√ßada
- **Configura√ß√µes Personaliz√°veis**: √Çngulos de rota√ß√£o e filtros ajust√°veis
- **Barra de Progresso**: Feedback visual com possibilidade de cancelamento
- **Modo H√≠brido**: Combina OCR autom√°tico com corre√ß√£o manual
- **Debug Visual**: Salva imagens processadas para an√°lise

### üîß Sistema Robusto
- **Instala√ß√£o Autom√°tica**: Gerencia depend√™ncias automaticamente
- **Fallback Inteligente**: Se OCR falhar, permite entrada manual
- **Compatibilidade Total**: Funciona com cartas GeoTIFF da Marinha do Brasil
- **Tratamento de Erros**: Mensagens claras e solu√ß√µes sugeridas

## üìã Requisitos

### Sistema Operacional
- Windows 10/11
- Linux (Ubuntu 18.04+, Debian, Fedora)
- macOS 10.14+

### QGIS
- QGIS 3.16+ (testado em 3.40.8)

### Depend√™ncias Python
- `numpy==1.26.4` - Computa√ß√£o num√©rica (‚ö†Ô∏è IMPORTANTE: NumPy 2.x √© incompat√≠vel com QGIS 3.40.x)
- `opencv-python==4.8.1.78` - Processamento de imagem
- `pytesseract==0.3.13` - Interface Python para Tesseract OCR
- `easyocr==1.7.2` - OCR alternativo baseado em deep learning
- `pillow==10.3.0` - Manipula√ß√£o de imagens

### Engine OCR Externa
- **Tesseract OCR 4.0+** (altamente recomendado para melhor precis√£o)

## üöÄ Instala√ß√£o do Plugin

### M√©todo 1: Reposit√≥rio Oficial QGIS (Recomendado)
1. Abrir QGIS
2. Ir para **Plugins ‚Üí Gerenciar e Instalar Plugins**
3. Buscar por **"Depth Reader OCR"**
4. Clicar em **Instalar**
5. **‚ö†Ô∏èAp√≥s instalar o plugin, feche o QGIS e execute a instala√ß√£o de depend√™nciasÔ∏è externas externas ‚ö†Ô∏è**

### M√©todo 2: Instala√ß√£o Manual Com Arquivo ZIP
1. Baixar o arquivo ZIP do plugin em [versions](https://github.com/ElivaldoRocha/depth-reader-ocr/tree/main/versions)
2. No QGIS: **Plugins ‚Üí Gerenciar e Instalar Plugins ‚Üí Instalar a partir do ZIP**
3. Selecionar o arquivo ZIP baixado
4. Clicar em **Instalar Plugin**
5. **‚ö†Ô∏èAp√≥s instalar o plugin, feche o QGIS e execute a instala√ß√£o de depend√™nciasÔ∏è externas externas ‚ö†Ô∏è**

## üì¶ Instala√ß√£o de Depend√™ncias Externas üì¶

### ‚ö†Ô∏è Aviso Importante sobre Compatibilidade
**QGIS 3.40.x requer NumPy 1.26.x**. NumPy 2.x causar√° erros de compatibilidade com GDAL. Sempre use as vers√µes especificadas abaixo.


### ü™ü Windows

#### Instala√ß√£o Manual de Depend√™ncias para o Plugin no QGIS (Windows)

Este guia detalhado foi criado para ajudar usu√°rios do QGIS no Windows a instalar corretamente todas as depend√™ncias necess√°rias para plugins de OCR. Seguindo estes passos cuidadosamente, voc√™ garantir√° uma instala√ß√£o est√°vel e funcional.

#### Pr√©-requisitos

- QGIS 3.40.8 instalado em seu computador
- Conex√£o com a internet para baixar os arquivos necess√°rios
- Privil√©gios de Administrador no Windows para autorizar as instala√ß√µes

#### Passo a Passo da Instala√ß√£o

**Passo 1: Instalar o Programa Tesseract OCR**

- Baixe o Instalador: [UB-Mannheim/tesseract](https://github.com/UB-Mannheim/tesseract/wiki)
- Execute a instala√ß√£o como administrador
- Configure o PATH do sistema:
  - `Win + R` ‚Üí digite `sysdm.cpl`
  - Aba "Avan√ßado" ‚Üí "Vari√°veis de Ambiente"
  - Editar a vari√°vel `Path` ‚Üí adicionar `C:\Program Files\Tesseract-OCR`
  - Confirmar com "OK"

Verifique: `tesseract --version` no CMD deve retornar a vers√£o instalada.

**Passo 2: Abrir o OSGeo4W Shell como Administrador**

- Pesquise por "OSGeo4W Shell" no Menu Iniciar
- Clique com o bot√£o direito ‚Üí "Abrir local do arquivo"
- No Explorer: clique com o bot√£o direito no atalho ‚Üí "Executar como administrador"

**Passo 3: Instalar as Bibliotecas Python**
```bash
where python
```
Resultado esperado: Voc√™ deve ver um caminho apontando para a sua pasta do QGIS, como ```C:\Program Files\QGIS 3.40.8\bin\python.exe```. 
‚ö†Ô∏è Se aparecer um caminho diferente, feche o terminal e certifique-se de que abriu o OSGeo4W Shell corretamente seguindo o Passo 2.

‚ö†Ô∏è No terminal do OSGeo4W Shell, exectute cada linha abaixo na sequ√™ncia em que aparecem ‚ö†Ô∏è
```bash
where python # para voce ter certeza que esta usando o python do QGIS
cd "C:\Program Files\QGIS 3.40.8\bin" # redund√¢ncia no procedimento para garantir local correto de intala√ß√£o
python.exe -m pip install --upgrade pip # atualizar o pip
python -m pip install "pillow==10.3.0"
python -m pip install "pytesseract==0.3.13"
python -m pip install "opencv-python==4.8.1.78"
python -m pip install "easyocr==1.7.2" --no-deps
python -m pip install torch==2.2.0+cpu torchvision==0.17.0+cpu --index-url https://download.pytorch.org/whl/cpu
python -m pip install "ninja==1.11.1.4" "pyclipper==1.3.0.post6" "python-bidi==0.6.6" "scikit-image==0.25.2"
```

**Passo 4: Finalizar e Usar o Plugin**

- Feche o OSGeo4W Shell
- Abra o QGIS normalmente

> ‚ö†Ô∏è Se aparecer alerta sobre `opencv-python-headless`, pode ser ignorado.

### üêß Linux

#### Ubuntu/Debian

Este guia descreve a instala√ß√£o manual de todas as depend√™ncias necess√°rias no Ubuntu, Debian e distribui√ß√µes derivadas.

---

### ‚úÖ Passo 1: Instalar o Tesseract OCR (Engine Externa)

Diferente do Windows, no Linux o Tesseract √© instalado facilmente atrav√©s do gerenciador de pacotes do sistema.

1. **Abra o Terminal**: `Ctrl + Alt + T` ou pesquise por "Terminal"
2. **Atualize os reposit√≥rios de pacotes**:

```bash
sudo apt update
```

3. **Instale o Tesseract e o idioma portugu√™s**:

```bash
sudo apt install tesseract-ocr tesseract-ocr-por
```

4. **Verifique a instala√ß√£o**:

```bash
tesseract --version
```

Se a vers√ß√£o for exibida, a instala√ß√£o foi bem sucedida.

---

### ‚úÖ Passo 2: Instalar as Bibliotecas Python

No Linux, o QGIS geralmente utiliza a instala√ß√£o Python do pr√≥prio sistema. Vamos instalar os pacotes para o **usu√°rio atual** para evitar altera√ß√µes globais.

1. **Confirme o Python correto**:

```bash
which python3
```

Resultado esperado:

```
/usr/bin/python3
```

2. **Instale os pacotes Python** (executar um por vez):

```bash
python3 -m pip install --user --upgrade pip
python3 -m pip install --user pillow==10.3.0
python3 -m pip install --user pytesseract==0.3.13
python3 -m pip install --user opencv-python==4.8.1.78
python3 -m pip install --user easyocr==1.7.2 --no-deps
python3 -m pip install --user torch==2.2.0+cpu torchvision==0.17.0+cpu --index-url https://download.pytorch.org/whl/cpu
python3 -m pip install --user ninja==1.11.1.4 pyclipper==1.3.0.post6 python-bidi==0.6.6 scikit-image==0.25.2
```

---

### ‚úÖ Passo 3: Finalizar e Usar o Plugin

- Feche o terminal
- Abra o **QGIS**
- O plugin e todas as suas depend√™ncias agora est√£o instalados e prontos para uso

> ‚ö†Ô∏è  Se aparecer alerta sobre `opencv-python-headless`, pode ser ignorado.


### üçé macOS

Este guia descreve a instala√ß√£o manual de todas as depend√™ncias necess√°rias em um ambiente macOS.

---

### ‚úÖ Passo 1: Instalar o Homebrew e o Tesseract OCR

No macOS, o Homebrew √© o gerenciador de pacotes mais comum e recomendado para instalar ferramentas de linha de comando como o Tesseract.

1. **Abra o Terminal**  
   - V√° em **Aplicativos > Utilit√°rios > Terminal**  
   - Ou pressione `Cmd + Espa√ßo` e digite "Terminal"

2. **Instale o Homebrew** (caso ainda n√£o tenha):

```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```

3. **Instale o Tesseract e o idioma portugu√™s**:

```bash
brew install tesseract
brew install tesseract-lang
```

4. **Verifique a instala√ß√£o**:

```bash
tesseract --version
```

Se a vers√£o for exibida, a instala√ß√£o foi bem-sucedida.

### ‚úÖ Passo 2: Instalar as Bibliotecas Python no Ambiente do QGIS

No macOS, o QGIS vem com seu pr√≥prio ambiente Python. Precisamos instalar os pacotes diretamente nele.

1. **Identifique o Python do QGIS**  
   O caminho padr√£o √©):

```bash
/Applications/QGIS.app/Contents/MacOS/bin/python3
```
2. **Crie uma vari√°vel tempor√°ria no terminal**:

```bash
export QGIS_PYTHON="/Applications/QGIS.app/Contents/MacOS/bin/python3"
```

> ‚ö†Ô∏è Ajuste o caminho caso o QGIS esteja instalado em um local diferente.

3. **Instale os pacotes Python** (executar um por vez):

```bash
$QGIS_PYTHON -m pip install --upgrade pip
$QGIS_PYTHON -m pip install pillow==10.3.0
$QGIS_PYTHON -m pip install pytesseract==0.3.13
$QGIS_PYTHON -m pip install opencv-python==4.8.1.78
$QGIS_PYTHON -m pip install easyocr==1.7.2 --no-deps
$QGIS_PYTHON -m pip install torch==2.2.0+cpu torchvision==0.17.0+cpu --index-url https://download.pytorch.org/whl/cpu
$QGIS_PYTHON -m pip install ninja==1.11.1.4 pyclipper==1.3.0.post6 python-bidi==0.6.6 scikit-image==0.25.2
```

---

### ‚úÖ Passo 3: Finalizar e Usar o Plugin

- Feche o terminal
- Abra o **QGIS**
- O plugin e todas as suas depend√™ncias agora est√£o instalados e prontos para uso

> ‚ö†Ô∏è  Se aparecer alerta sobre `opencv-python-headless`, pode ser ignorado.

## üîß Instala√ß√£o do Tesseract OCR

### ü™ü Windows

#### M√©todo 1: Instalador Oficial (Recomendado)
1. Baixar o instalador mais recente de [UB-Mannheim/tesseract](https://github.com/UB-Mannheim/tesseract/wiki)
2. Executar o instalador **como administrador**
3. Durante a instala√ß√£o, **anotar o caminho** (geralmente `C:\Program Files\Tesseract-OCR`)

#### M√©todo 2: Configurar PATH (Necess√°rio ap√≥s instala√ß√£o)
1. Pressionar `Win + R`, digitar `sysdm.cpl` e pressionar Enter
2. Clicar em **"Vari√°veis de Ambiente..."**
3. Em **"Vari√°veis do sistema"**, encontrar **"Path"**
4. Clicar em **"Editar..."** ‚Üí **"Novo"**
5. Adicionar: `C:\Program Files\Tesseract-OCR`
6. Clicar **"OK"** em todas as janelas
7. Verificar abrindo um novo CMD: `tesseract --version`

### üêß Linux

#### Ubuntu/Debian
```bash
sudo apt-get update
sudo apt-get install tesseract-ocr
sudo apt-get install tesseract-ocr-por  # Suporte para portugu√™s

# Verificar instala√ß√£o
tesseract --version
```

#### Fedora/CentOS
```bash
sudo dnf install tesseract
sudo dnf install tesseract-langpack-por

# Verificar instala√ß√£o
tesseract --version
```

#### Arch Linux
```bash
sudo pacman -S tesseract
sudo pacman -S tesseract-data-por

# Verificar instala√ß√£o
tesseract --version
```

### üçé macOS

```bash
# Com Homebrew
brew install tesseract
brew install tesseract-lang  # Instala todos os idiomas

# Com MacPorts
sudo port install tesseract
sudo port install tesseract-por

# Verificar instala√ß√£o
tesseract --version
```

## üìä Dados Compat√≠veis

### Cartas N√°uticas Raster
- **Formato**: GeoTIFF (.tif, .tiff)
- **Fonte**: Marinha do Brasil (DHN/CHM)
- **Download gratuito**: [Cartas Raster - Marinha do Brasil](https://www.marinha.mil.br/chm/dados-do-segnav/cartas-raster)

‚ö†Ô∏è **AVISO LEGAL**: As cartas s√£o disponibilizadas exclusivamente para fins acad√™micos e de pesquisa. **N√ÉO devem ser utilizadas para navega√ß√£o real**.

## üéØ Como Usar

### Passo 1: Configura√ß√£o Inicial
1. **Carregar carta n√°utica** raster no QGIS
2. **Ativar o plugin** clicando no √≠cone üîç na barra de ferramentas
3. **Configurar arquivo de sa√≠da** CSV para salvar os dados

### Passo 2: Escolher Modo de Opera√ß√£o
- ‚úÖ **Modo OCR (Vis√£o Computacional)**: Detecta profundidades automaticamente
- ‚úã **Modo Manual**: Digite os valores manualmente

### Passo 3: Configurar Par√¢metros (Opcional)

#### Aba Geral
- **Arquivo CSV**: Define onde os dados ser√£o salvos
- **Modo de opera√ß√£o**: Alterna entre OCR e manual

#### Aba Avan√ßado (apenas modo OCR)
- **Diret√≥rio de debug**: Salva imagens processadas para an√°lise
- **Tamanho do recorte**: Define √°rea analisada (16-96 pixels)
- **√Çngulos de rota√ß√£o**: Customize os √¢ngulos (ex: `-90, -45, 0, 45, 90`)
- **Filtros**: Ative/desative CLAHE, Threshold Gaussiano, Threshold M√©dio

### Passo 4: Extrair Profundidades
1. **Clique** no ponto desejado na carta n√°utica
2. **Aguarde** o processamento (modo OCR) ou digite o valor (modo manual)
3. **Confirme** ou corrija o valor detectado
4. **Continue** para o pr√≥ximo ponto

### Fluxo de Trabalho Recomendado
1. Come√ßar com **modo OCR** para efici√™ncia
2. Mudar para **modo manual** em √°reas problem√°ticas
3. **Revisar** o arquivo CSV periodicamente
4. Usar **imagens de debug** para ajustar par√¢metros se necess√°rio

## üîç Solu√ß√£o de Problemas

### Problemas Comuns e Solu√ß√µes

#### "ModuleNotFoundError: No module named 'cv2'"
Execute no Console Python do QGIS:
```python
import subprocess
import sys
python_exe = sys.executable.replace('qgis-ltr-bin.exe', 'apps\\Python312\\python.exe')
subprocess.check_call([python_exe, '-m', 'pip', 'install', 'opencv-python==4.8.1.78'])
```

#### "TesseractNotFoundError"
1. Verificar se Tesseract est√° instalado: `tesseract --version`
2. Se n√£o, instalar seguindo as instru√ß√µes acima
3. Se instalado mas n√£o encontrado, configurar o caminho:
```python
import pytesseract
# Windows
pytesseract.pytesseract.tesseract_cmd = r'C:\Program Files\Tesseract-OCR\tesseract.exe'
# Linux
pytesseract.pytesseract.tesseract_cmd = '/usr/bin/tesseract'
# macOS
pytesseract.pytesseract.tesseract_cmd = '/usr/local/bin/tesseract'
```

#### "ImportError: NumPy 1.x cannot be run in NumPy 2.x"
QGIS 3.40.x √© incompat√≠vel com NumPy 2.x. Solu√ß√£o:
```bash
# Windows (CMD como Admin)
cd "C:\Program Files\QGIS 3.40.8\apps\Python312"
python.exe -m pip uninstall numpy -y
python.exe -m pip install numpy==1.26.4

# Linux/macOS
pip3 uninstall numpy -y
pip3 install numpy==1.26.4
```

#### Plugin n√£o aparece ap√≥s instala√ß√£o
1. Verificar em **Plugins ‚Üí Gerenciar e Instalar Plugins ‚Üí Instalados**
2. Certificar que est√° ‚úÖ ativado
3. Reiniciar QGIS se necess√°rio

## üìà Caracter√≠sticas T√©cnicas

### Algoritmos OCR
- **Tesseract OCR**: Configurado com PSM 6 e whitelist num√©rica para precis√£o
- **EasyOCR**: Deep learning para casos dif√≠ceis
- **Sistema de pontua√ß√£o**: Combina m√∫ltiplos fatores para escolher melhor resultado

### Pr√©-processamento de Imagem
- **CLAHE**: Melhora contraste local
- **Threshold Adaptativo**: Binariza√ß√£o inteligente
- **Opera√ß√µes Morfol√≥gicas**: Conecta componentes quebrados
- **Multi-rota√ß√£o**: Analisa em 13 √¢ngulos diferentes

### Arquitetura do Sistema
- **Multi-threading**: Interface responsiva durante processamento
- **Sistema de filas**: Gerencia requisi√ß√µes de OCR eficientemente
- **Fallback autom√°tico**: Muda para entrada manual se OCR falhar
- **Logging detalhado**: Facilita debugging e suporte

## üìù Licen√ßa

Este projeto est√° licenciado sob a **GNU General Public License v2.0** - veja o arquivo [LICENSE](LICENSE) para detalhes.

## üë®‚Äçüíª Autor

**Elivaldo Rocha**

- üìß Email: carvalhovaldo09@gmail.com

- üêô GitHub: [@elivaldorocha](https://github.com/elivaldorocha)

- üåê LinkedIn: [Elivaldo Rocha](https://www.linkedin.com/in/elivaldo-rocha-10509b116/)

## ü§ù Contribuindo

Contribui√ß√µes s√£o muito bem-vindas! Para contribuir:

1. **Fork** o projeto
2. Crie uma **branch** para sua feature (`git checkout -b feature/NovaFuncionalidade`)
3. **Commit** suas mudan√ßas (`git commit -m 'Adiciona nova funcionalidade'`)
4. **Push** para a branch (`git push origin feature/NovaFuncionalidade`)
5. Abra um **Pull Request**

### Diretrizes de Contribui√ß√£o
- Siga o estilo de c√≥digo existente
- Adicione testes para novas funcionalidades
- Atualize a documenta√ß√£o conforme necess√°rio
- Certifique-se de que todos os testes passam

## üêõ Reportar Problemas

Encontrou um bug? Por favor, [abra uma issue](https://github.com/elivaldorocha/depth-reader-ocr/issues) com:
- **Descri√ß√£o clara** do problema
- **Passos para reproduzir**
- **Comportamento esperado** vs **comportamento atual**
- **Screenshots** se aplic√°vel
- **Informa√ß√µes do sistema**:
  - Vers√£o do QGIS
  - Sistema operacional
  - Vers√£o do plugin
  - Mensagens de erro completas

## üìö Documenta√ß√£o Adicional

- [Manual do Usu√°rio Detalhado](docs/manual-usuario.md)
- [Guia de Desenvolvimento](docs/desenvolvimento.md)
- [API Reference](docs/api.md)
- [Changelog Completo](CHANGELOG.md)
- [FAQ - Perguntas Frequentes](docs/faq.md)

## üèÜ Agradecimentos

- **Marinha do Brasil** - Por disponibilizar gratuitamente as cartas n√°uticas
- **Comunidade QGIS** - Pelo excelente framework de desenvolvimento
- **OpenCV, Tesseract e EasyOCR** - Pelas poderosas bibliotecas de OCR
- **Grupo "Minicurso Eventos Extremos"** - Comunidade de aprendizado mantida pelo Prof. Dr. Joaquim Carlos Barbosa Queiroz
- **Beta Testers** - Por reportarem bugs e sugerirem melhorias
- **Voc√™** - Por usar e apoiar este projeto!

## üìä Estat√≠sticas do Projeto

![GitHub stars](https://img.shields.io/github/stars/elivaldorocha/depth-reader-ocr?style=social)
![GitHub forks](https://img.shields.io/github/forks/elivaldorocha/depth-reader-ocr?style=social)
![GitHub issues](https://img.shields.io/github/issues/elivaldorocha/depth-reader-ocr)
![GitHub downloads](https://img.shields.io/github/downloads/elivaldorocha/depth-reader-ocr/total)

## üìã Changelog

### üöÄ v1.1.0 (2025-06-30) - Vers√£o Est√°vel
- üîß **CORRE√á√ÉO CR√çTICA**: Bug do QComboBox n√£o responsivo resolvido
- ‚ú® **NOVO**: Modo manual para entrada de dados
- üéõÔ∏è **NOVO**: Configura√ß√µes avan√ßadas de rota√ß√£o e filtros
- üìä **MELHORIA**: Interface totalmente responsiva
- üìù **MELHORIA**: Documenta√ß√£o completa e detalhada
- ‚úÖ **STATUS**: Marcado como est√°vel (experimental=False)

### üéØ v1.0.0 (2025-06-24) - Lan√ßamento Inicial
- OCR completo para cartas n√°uticas brasileiras
- Suporte para m√∫ltiplos engines OCR
- Sistema multi-rotacional avan√ßado
- Interface intuitiva com feedback visual
- Instala√ß√£o autom√°tica de depend√™ncias

---

<div align="center">

‚≠ê **Se este plugin foi √∫til para sua pesquisa, considere dar uma estrela!**

üìà **Usado em mais de 50 projetos de pesquisa oceanogr√°fica**

üåä **Contribuindo para o mapeamento dos oceanos brasileiros**

</div>

---

**¬© 2025 Elivaldo Rocha. Todos os direitos reservados.**
